<!DOCTYPE html>
<html lang="en">

<head>
	<title>Login</title>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<!--===============================================================================================-->
	<link rel="icon" type="image/png" href="images/icons/favicon.ico" />
	<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="vendor/bootstrap/css/bootstrap.min.css">
	<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="fonts/font-awesome-4.7.0/css/font-awesome.min.css">
	<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="fonts/iconic/css/material-design-iconic-font.min.css">
	<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="vendor/animate/animate.css">
	<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="vendor/css-hamburgers/hamburgers.min.css">
	<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="vendor/animsition/css/animsition.min.css">
	<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="vendor/select2/select2.min.css">
	<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="vendor/daterangepicker/daterangepicker.css">
	<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="css/util.css">
	<link rel="stylesheet" type="text/css" href="css/main.css">
	<!--===============================================================================================-->
</head>

<body>

	<div class="limiter">
		<div class="container-login100">
			<div class="wrap-login100">
				<form class="login100-form validate-form">
					<span class="login100-form-title p-b-26">
						Change Password
					</span>


					<span class="login100-form-title p-b-48">

						<a class='navbar-brand' href='../index.html'><img src="logo1.png"
								style="margin-top:20px;height: 90px;" alt="image"></a>
						<!-- <i class="zmdi zmdi-font"></i> -->
					</span>



					<div class="wrap-input100 validate-input" data-validate="Enter password">
						<span class="btn-show-pass">
							<i class="zmdi zmdi-eye"></i>
						</span>
						<input class="input100" type="password" name="n-pass">
						<span class="focus-input100" data-placeholder="New Password"></span>
					</div>

					<div class="wrap-input100 validate-input" data-validate="Enter password">
						<span class="btn-show-pass">
							<i class="zmdi zmdi-eye"></i>
						</span>
						<input class="input100" type="password" name="c-pass">
						<span class="focus-input100" data-placeholder="Confirmed Password"></span>
					</div>


					<div class="container-login100-form-btn">
						<div class="wrap-login100-form-btn">
							<div class="login100-form-bgbtn"></div>
							<button class="login100-form-btn">
								Change Password
							</button>
						</div>
					</div>

					<div class="text-center p-t-115">
						<span class="txt1">
							Donâ€™t have an account?
						</span>

						<a class="txt2" href="signup.html">
							Sign Up
						</a>
					</div>
				</form>
				<!-- Forgot Password link -->
				<div class="text-center p-t-20">
					<a class="txt2" href="forgetpassword.html">
						Forgot Password?
					</a>
				</div>
			</div>
		</div>
	</div>


	<div id="dropDownSelect1"></div>

	<!--===============================================================================================-->
	<script src="vendor/jquery/jquery-3.2.1.min.js"></script>
	<!--===============================================================================================-->
	<script src="vendor/animsition/js/animsition.min.js"></script>
	<!--===============================================================================================-->
	<script src="vendor/bootstrap/js/popper.js"></script>
	<script src="vendor/bootstrap/js/bootstrap.min.js"></script>
	<!--===============================================================================================-->
	<script src="vendor/select2/select2.min.js"></script>
	<!--===============================================================================================-->
	<script src="vendor/daterangepicker/moment.min.js"></script>
	<script src="vendor/daterangepicker/daterangepicker.js"></script>
	<!--===============================================================================================-->
	<script src="vendor/countdowntime/countdowntime.js"></script>
	<!--===============================================================================================-->
	<script src="js/main.js"></script>


	<script>
		document.addEventListener("DOMContentLoaded", function () {
			// Get the form element
			const form = document.querySelector('.login100-form');

			// Add a submit event listener to the form
			form.addEventListener('submit', async function (event) {
				// Prevent the form from submitting the default way
				event.preventDefault();

				// Get the form element
				const form = event.target;

				// Get the new password and confirmed password from the form inputs
				const password = form.elements['n-pass'].value;
				const confirmedPassword = form.elements['c-pass'].value;

				if (password.length < 8) {
					alert('Password must be at least 8 characters long.');
					return; // Stop the function execution to prevent form submission
				}
				// Validate the new password and confirmed password
				if (password !== confirmedPassword) {
					alert('The confirmed password does not match the new password.');
					return;
				}

				// Retrieve user data from local storage (assuming user data is stored there)
				const userData = JSON.parse(localStorage.getItem('user'));

				// Extract user ID from user data
				const userId = userData ? userData._id : null;

				// Check if user ID is available
				if (!userId) {
					alert('User not found.');
					return;
				}

				// Define the API endpoint for password change
				const apiUrl = `http://localhost:8800/auth/change-password?Id=${userId}`;

				// Prepare the request payload
				const requestData = {
					password: password
				};

				try {
					// Send an asynchronous request to update the password
					const response = await fetch(apiUrl, {
						method: 'POST',
						headers: {
							'Content-Type': 'application/json'
						},
						body: JSON.stringify(requestData)
					});

					// Parse the JSON response
					const data = await response.json();

					// Handle the response appropriately
					if (response.ok) {
						alert('Password changed successfully.');
						window.location.href = './signin.html'
						// Redirect to a different page or perform other actions if needed
					} else {
						alert(`Failed to change password: ${data.message}`);
					}
				} catch (error) {
					// Handle any errors during the request
					console.error('Error changing password:', error);
					alert('An error occurred while changing the password. Please try again.');
				}
			})
		})
	</script>

</body>

</html>